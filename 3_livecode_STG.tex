\section{競技性・観戦性を拡張したプログラミングゲームの開発}
本項では，プログラミング初学者の興味喚起を目的としたプログラミングゲームのプロトタイプについて紹介し，設計指針に基づくデザインの詳細や行った評価実験と見つかった課題，実験に関する考察について議論する．

\subsection{関連研究・関連システム}

\subsubsection{プログラミングを用いたエンタテインメントシステム}
プログラミングとエンタテインメントを掛け合わせたコンテンツはいくつか存在する．TopCoder\cite{topcoder}などの競技プログラミングやコードゴルフ\cite{codegolf}，SECCON\cite{seccon}などのハッキングコンテストが有名であり，プログラマの間でも根強い人気がある．またプログラミングゲームとしてはRobocode\cite{robocode}が有名である．しかしこれらはある程度プログラミングに習熟したプログラマ向けのコンテンツであるため，数学やセキュリティ，コンピュータサイエンス等の知識を要するためプログラミング初学者が参加するにはハードルが高い．

\subsubsection{初学者向けプログラミング学習支援システム}
初学者向けプログラミング学習支援システムは数多く存在する．Scratch\cite{scratch},Viscuit\cite{viscuit}などはその代表的な例であり，低年齢層をターゲットにした設計でブロックや絵を並べることでプログラミングでき，初学者にプログラミングの楽しさを伝えるためにデザインされている．またドリトル\cite{dolittle}は中学校・高等学校での教育目的に使える環境を目指し，テキストベースでプログラミングさせつつも柔軟かつ小さい言語仕様により，初学者にプログラミングの楽しさを伝えることを目指している．しかしプログラマに対する憧れを創出し，プログラミングへのモチベーションを高めるという本研究のアプローチとは異なる．

\subsubsection{エンタテインメントを活用したプログラミング学習支援システム}
エンタテインメントの要素を盛り込むことでプログラミング学習を促進しようとした研究は多くある．Joshaらはプログラミングゲームを用いてプログラミング初学者の問題解決能力を向上させるためのシステムを作成している\cite{joshua}．また水口の研究ではプログラミングの講義における成績評価にロボットバトルシミュレーション型のプログラミングゲームを活用している\cite{minakuchi}．三谷らの研究ではキャラクタをプログラムで制御するプログラミングゲームでプログラミングスキルの向上を図っている\cite{mitani}．なお増谷らの開発したVLogic\cite{mashitani}ではVR空間上にブロックベースのプログラミングゲームを実装することで手足を使ってプログラミングを体験することができ，プログラミングに対する興味喚起を行っている．これらはプログラミングの習熟度が高くなくても使用できるが，従来のプログラミングゲーム同様静的なゲーム展開であり，プログラマ同士のリアルタイムな駆け引きやアドリブといった観戦を楽しむ設計は成されていない．



\subsection{設計指針}

提案システムの実装にあたり，初学者の興味関心を高めるために3つの設計指針を設けた．

\begin{enumerate}
	\item 観戦するにあたり，高度な専門知識を必要としない
	
	初学者が提案システムでの対戦を観戦するにあたり高度な専門知識を必要としてしまっては，利用の心理的ハードルを上げかねない．極力前提知識なしに理解し，楽しめるようにデザインする必要がある．
	
	\item 手間がかからない

	初学者にとってプログラミング学習をする際に環境構築や普段使用しない独自ソフトウェアのインストールはモチベーションを下げかねない．今回は提案システムをJavaScriptによって制御可能なWebアプリケーションとして実装し，初学者が実際にプログラミングを行わずとも見るだけで利用できるようにした．
	
	\item リアルタイムな駆け引き・アドリブを取り入れる

	従来のプログラミング教育コンテンツとは異なり，スポーツなどの観戦する競技で見られるようなリアルタイムな駆け引き・アドリブの要素を提案システムに組み込むことで観戦して楽しめるようなデザインをする．
\end{enumerate}

\subsection{提案システム}

本研究で提案するシステムでは，プログラミング初学者の興味喚起をするためにいくつかの工夫を施した．今回実装したシステムは，プログラマ同士がリアルタイムにプログラミングを行うことでキャラクタを制御し，対戦するという対人形式のプログラミングゲームである．この対戦の様子を初学者に観戦させることで，初学者のプログラミングに対する興味を高める．プログラミングゲームとして実装した理由としては，キャラクタがプログラムによって動作するというゲームの視覚的な出力が，初学者にとってプログラムの出力を理解する助けになると考えたためである．ゲームジャンルとしては，シューティングゲームの体裁をとった．これはシューティングゲームが「敵の攻撃を避けて，敵を攻撃する」というプリミティブなゲームシステムであり，見ていて展開を理解しやすいと考えたためである．またゲームUIはLivecodeLabやHydraなどのビジュアルライブコーディング環境を踏襲し，ゲーム画面上にエディタを重畳することで，プログラムとその出力の双方を同時に見ることが可能なように設計した．またゲームは以下の3つのフェイズに分かれている．

\subsubsection{自機プログラミングフェイズ}
対戦が開始するとこのフェイズに移行する．ここでは予めエディタにプレイヤが操作するキャラクタのコンストラクタが記述されており，プレイヤはパラメータを書き換えることができる．具体的なパラメータにはappearance,life,clock,powerがある．appearanceはキャラクタの外見であり，文字列を指定できるため，絵文字などを使ってプレイヤの好きな見た目を選ぶことが可能である．lifeはキャラクタの体力であり，いわゆるHP(ヒットポイント)を表している．非負の整数を指定でき，この値が0以下になるとプレイヤはゲームに敗北する．clockはキャラクタが行動できる回数の多さを表しており，非負の整数を指定できる．プレイヤは後述する行動プログラミングフェイズにおいて自分のキャラクタを制御するプログラムを記述し対戦するが，その際に記述したプログラムは10秒間ループして実行される．このループのインターバルを決めるのがclockであり，値が大きいほどインターバルは短くなる．powerはキャラクタの攻撃力を表しており，これも非負の整数を指定できる．この値が大きいほど，自分が操作するキャラクタの攻撃が相手キャラクタに命中した際に削るlifeの値が大きくなる．双方のプレイヤが各パラメータを記述し終わると次の行動プログラミングフェイズに移行する．このフェイズの様子を図\ref{characterProgramming}に示す．

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/characterProgramming.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{自機プログラミングフェイズの様子}
  \label{characterProgramming}
\end{figure}

\subsubsection{行動プログラミングフェイズ}
このフェイズに進むと，自機プログラミングフェイズで記述したコンストラクタを元に各プレイヤが操作するキャラクタのインスタンスが作成され，ゲーム画面が表示される．各プレイヤはプログラムをエディタに記述し，作成したキャラクタを操作する．プレイヤは条件分岐や繰り返しなど従来のJavaScriptの文法の他に独自に用意されたプロトタイプメソッドを使うことができる．用意したメソッドにはキャラクタを移動するメソッド(moveUp(), moveDown(),randomMove())とキャラクタが攻撃を行うメソッド(shot())などがある．またプログラム内で各キャラクタのパラメータを参照することもできる．両プレイヤがプログラムを記述し終わると次のゲームフェイズに移行する．なおこのフェイズでは相手プレイヤがどのようなプログラムを記述しているかは見ることができない．このフェイズの様子を図\ref{actionProgramming}に示す．

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/actionProgramming.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{行動プログラミングフェイズの様子}
  \label{actionProgramming}
\end{figure}

\subsubsection{ゲームフェイズ}
このフェイズでは行動プログラミングフェイズで記述したプログラムが10秒間ループして実行され，ゲームが進行する．この段階で両プレイヤは相手プレイヤが記述したプログラムを閲覧することができる．このフェイズにおいて相手キャラクタを攻撃し，lifeの値を0いかにしたプレイヤの勝利となる．勝敗が決まらない場合はプログラム終了時の各パラメータを引き継いだまま行動プログラミングフェイズに戻り，再度プログラミングしゲームフェイズに移行するという過程を勝敗が決まるまで繰り返す．このフェイズの様子を図\ref{game}に示す．

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/game.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{ゲームフェイズの様子}
  \label{game}
\end{figure}

\subsection{評価実験}
提案システムの使用・観戦に関する感想や影響，用法を調査するために評価実験を実施した．システムをプレイするプログラマと観戦するプログラミング初学者を集め，システムでの対戦と観戦を実施し，アンケート調査と実際に対戦で使用されたプログラムのログを分析することでシステムを評価した．

\subsubsection{実験参加者}
実際にゲームをプレイするプログラマとしては，プログラミング(主にオブジェクト指向言語)の経験が3年以上ある大学院生2名(男性)に声をかけた．2名とも日常的にアクションやシューティング等のジャンルのゲームをプレイするため，システムをプレイする際にゲームに不慣れなためハンデが生まれることはないと思われる．また両者とも3年以上JavaScriptを使用した経験がある．
またプレイを観戦するプログラミング初学者は，国際人間科学部にて開講されていた講義「プログラミング基礎演習1」の受講者をとした．受講者のうち，実験に参加した者は77名であり，うち37名が男性，40名が女性であった．またこの講義ではJavaScriptにおける変数，条件分岐，繰り返しなどの基礎的な文法を教えており，実験参加者は実験を行う時点でこれらを学習済であった．なお，うち23名は授業以前にプログラミングを学習した経験があったが，ソフトウェア開発を行ったことのある者はいなかった．
またプログラマ含む実験参加者の全員が，競技プログラミングやプログラミングゲームなどのプログラミングを題材としたエンタテインメントを使用した経験がなかった．

\subsubsection{実験内容}

初めにプログラマ2人に簡単な事前アンケートを行った後，提案システムにある程度慣れ，用法を理解してもらう必要があるため，システムの練習をするための期間を設けた．システムの使用方法，ゲームシステム，独自に用意したメソッドなどについて説明した後，11/13から11/19の1週間システムを自由に使用させた．また，ただシステムを使用させただけではゲームに対する理解度が上がらない可能性があるため，期間中に2つのタスクをこなさせた．1つは1人以上とシステムを使った対人戦を行うことであり，もう1つは相手がランダムな戦略を実行してくる対CPU戦において，勝率が高いと考えられるプログラムを作成することである．なお期間中はシステムに関する意見・疑問を逐次報告させ，システム使用における問題を改善した．
練習期間が終わった翌日に，プログラマ同士の対戦を行った．対戦はシステムに関するプログラマ同士のコミュニケーション等の所作を観察するため，感染症対策を徹底した環境で対面にて行った．両者の対戦時の画面を録画し，対戦後にシステムに関する事後アンケートを行った．なお練習期間中・対戦中にプログラマが記述した全てのコードのログを収集した．
そして「プログラミング基礎演習1」の最終講義で受講者に事前アンケートを行った後，初学者が観戦しやすいように対戦動画を編集したものをzoomを介して閲覧させた．またその後にシステムに関する事後アンケートを行った．

\subsubsection{実験結果}

\begin{enumerate}
  \item アンケート結果

  \begin{table}[h]
    \centering
    \caption{初学者に対する事後アンケート結果}
    \label{beginner_interview}
      \begin{tabular}{|c|c|c|c|c|c|c|c|} \hline
        \multirow{2}{*}{Q} & \multirow{2}{*}{質問項目} & \multicolumn{5}{c}{評価分布} & \multirow{2}{*}{平均} \\
        & & 1 & 2 & 3 & 4 & 5 & \\ \hline\hline
        Q1 & ゲームを観戦するのは楽しかったか & 3 & 6 & 33 & 27 & 5 & 3.34\\ \hline
        Q2 & ゲームの出力はプログラムを理解する助けになったか & 0 & 9 & 25 & 30 & 10 & 3.55\\ \hline
        Q3 & 観戦によってプログラミングに対する興味関心は高まったか & 1 & 11 & 23 & 33 & 6 & 3.43\\ \hline
        Q4 & 観戦によってプログラミングに関する理解が深まったか & 1 & 23 & 29 & 17 & 4 & 3.00\\ \hline
      \end{tabular}
  \end{table}

  対戦を観戦したプログラミング初学者に対する事後アンケートの内容及び結果を表\ref{interview}に示す．まずゲーム観戦の楽しさに関して(Q1)であるが，実験参加者の多くが肯定的な回答を示した．またキャラクタが攻撃，移動するなどのゲームの出力がプログラム理解の助けになったかという質問(Q2)に関しても3以上の評価が多かった．また観戦によりプログラミングに対する興味関心が高まったかという質問(Q3)についても，3以上の回答が多くなった．また観戦によってプログラミングに関する理解が深まったかという質問(Q4)に関しては，やや低い評価が多い結果となった．またこれら意外にも以下の質問をした．

  \begin{itemize}
    \item Q5.このゲームを実際にプレイしたいか(プレイしたい/プレイしたくない)
    \item Q6.このゲームに他にどのような機能が欲しいか
    \item Q7.このゲームに関する意見
  \end{itemize}

  まずこのゲームを実際にプレイしたいかという質問(Q5)に関しては64.9\%がプレイしたいと回答した．またこのゲームに他にどのような機能が欲しいかという質問(Q6)に関しては「色んな技が繰り出せるような機能」「通常攻撃以外にため技のようなものが欲しいと思った」「回復アイテム的なものや必殺技」「攻撃を受けたときの衝撃波」などの回答があり，キャラクタの行動，エフェクト，アイテムの追加などを求める意見が多く見られた．また「プログラム内容を解説する機能が欲しい」という意見も複数あり，Q4の結果にも見られるように，プログラムの内容をより分かりやすくする工夫が必要だと考えられる．またこのゲームに関する意見(Q7)としては，「自分のプログラミングのレベルを上げたいと思った」「面白い」「プログラミングを楽しみながら学習できると言う点でとても面白いと感じた」などゲームに対する肯定的な意見が多く得られた．しかし「プログラミング初心者には少し難しかった」「楽しめるようになるまでのハードルが高そうだった」「今持っている知識では自分では動かすことが出来ないと感じた」などゲームをプレイするのは難しそうだという反応も多く得られた．
  またシステムをプレイしたプログラマにも同様に事後アンケートを行った．その内容・結果を表\ref{interview}に示す．

  \begin{table}[h]
    \centering
    \caption{プログラマに対する事後アンケート結果}
    \label{programmer_interview}
      \begin{tabular}{|c|c|c|c|} \hline
        Q & 質問項目 & プログラマA & プログラマB \\ \hline
        Q1 & システムをプレイするのは楽しかったか & 4 & 5 \\ \hline
        Q2 & ゲームの出力はプログラムを理解する助けになったか & 4 & 5\\ \hline
        Q3 & プレイすることでプログラミングに対する興味関心は高まったか & 3 & 5\\ \hline
        Q4 & プレイによってプログラミングに関する理解が深まったか & 1 & 3\\ \hline
      \end{tabular}
  \end{table}
  この結果についても初学者に対する事後アンケートと同様の傾向があり，Q1，Q2，Q3については肯定的な評価が得られたが，Q4に関してはやや評価が低い結果となった．またそれら以外にも以下の質問をした．

  \begin{itemize}
    \item Q5.累計何時間程度システムを使用したか
    \item Q6.ゲームの難易度は自分にとって適切だったか
    \item Q7.どのような点が簡単(難しい)と感じたか
    \item Q8.ゲームに他にどのような機能が欲しいか
    \item Q9.今後もこのゲームを使用したいか
    \item Q10.ゲームに関する意見
  \end{itemize}

  累計何時間程度システムを使用したかという質問(Q5)に関しては1名が2時間，1名が6時間と回答した．またゲームの難易度は自分にとって適切だったかという質問(Q6)に関しては1名が適切だった，1名がやや難しかったと答えた．具体的には(Q7)「リファレンスが乏しくプログラムを書きづら買った」「現状のシステムではある程度システムを使い込んだ人をを想定した作戦を立てづらかった」と回答した．ゲームに他にどのような機能が欲しいかという質問(Q8)に対しては，「オブジェクトが持っている値を確認できるリファレンスのようなものが欲しい」「横移動ができれば，被弾しやすいリスクと引き換えに，敵が来そうな位置で敵より先に弾を打ち込めるチャンスが増える」と回答していた．また今後もこのゲームを使用したいか(Q9)という質問には2名とも「使用したい」と回答した．なおゲームに関する意見は「相手のコードを読んで対処するという部分をもっと積極的にするべきだったかもしれない．ただし，相手の位置に近づくようにプログラムすれば確実に自分が先に被弾するので，自分は動かずに相手が近づくのを待つプログラム以外最良の手がないようにも思う．」というものが得られた．

  \item コードログ分析結果

  練習期間中・対戦中にプログラマが記述したプログラムのログ，提出したプログラムを分析することで，システムがどのように利用されているか，どのようなプログラムが記述されているかを調査した．
  まずvsComputerモードで使用されたプログラムの分析結果について述べる．このモードで使用されたコードは合計327件である．全てのプログラムに含まれていたキーワード(演算子を除く)の個数をグラフ化したものを図\ref{vsComputer_keyword}に示す.もっとも多いキーワードはmyselfというものであるがこれは自キャラクタのインスタンスを代入するための変数として使われていた．プロトタイプシステムではプレイヤがplayer1になるかplayer2になるかがランダムに決定されていたため，それによってプログラムの内容を書き換えなくて済むように初めにmyselfに割り当てられたインスタンスを代入していたと思われる．次にplayer1というインスタンスを参照するキーワードが多く見られ，次いでインスタンスの座標を参照するキーワードであるy，条件分岐に用いられるifのキーワードが多く見られた．プログラムの内容を観察するとキャラクタの座標を参照し，その値によって処理を分岐するプログラムが多く見られ，キーワードの分析結果と一致した．また「0x」で始まるキーワードがいくつか散見されるが，これはプレイヤが難読化ツールを用いてプログラムの難読化を試みた際に現れたキーワードである．


  \begin{figure}[!ht]
    \begin{center}
      \includegraphics[width=1.0\linewidth]{image/vsComputer_result.eps}
    \end{center}
      \vspace{-8mm} 
    \caption{vsComputerにおけるキーワード分析}
    \label{vsComputer_keyword}
  \end{figure}

次にvsComputerで投稿された各プログラムとSLOC・パラメータ数をグラフ化したものを図\ref{vsComputer_sloc_and_params}表示する．全体として徐々にSLOCが増加しており，ゲームに習熟するほどコードの量が長くなっていったのだと考えられる．またSLOCが平行線をたどり，パラメータの数が増加している部分は難読化ツールを使用した部分である．


\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/vsComputer_escomplex_SLOC_params.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{vsComputerにおけるSLOCとパラメータ数}
  \label{vsComputer_sloc_and_params}
\end{figure}

次にvsComputerにおける各プログラムの循環的複雑度を計測したグラフを図\ref{vsComputer_cyclomatic_complexity}示す．このグラフを観察すると循環的複雑度は11以下に収まっており，分岐によりプログラムの可読性を損なっていることはないと考えられる．

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/vsComputer_escomplex_complexity.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{vsComputerにおける循環的複雑度とその密度}
  \label{vsComputer_cyclomatic_complexity}
\end{figure}

次にvsPlayerにおいて使用されたプログラムの分析結果について述べる．このモードで使用されたコードは合計185件である．全てのプログラムに含まれていたキーワード(演算子を除く)の個数をグラフ化したものを図\ref{vsPlayer_keyword}に示す．vsPlayerにおいて多かったキーワードは上からmyself,if,yであり，vsComputerとプログラムの内容は大きく変わっていないと考えられる．
\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/vsPlayer_result.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{vsPlayerにおけるキーワード分析}
  \label{vsPlayer_keyword}
\end{figure}

また各プログラムとSLOC・パラメータ数をグラフ化したものを\ref{vsPlayer_sloc_and_params}表示する．

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/vsPlayer_escomplex_SLOC_params.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{vsPlayerにおけるSLOCとパラメータ数}
  \label{vsPlayer_sloc_and_params}
\end{figure}

次にvsPlayerにおける各プログラムの循環的複雑度を計測したグラフを図\ref{vsPlayer_complexity}示す．vsPlayerにおいても循環的複雑度の最大値は11であり，複雑な分岐はプログラム内に見られなかった．

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{image/vsPlayer_escomplex_complexity.eps}
  \end{center}
    \vspace{-8mm} 
  \caption{vsPlayerにおける循環的複雑度}
  \label{vsPlayer_complexity}
\end{figure}
\end{enumerate}


\subsubsection{考察}
評価実験に関する考察について述べる．プログラマ同士の対戦においては，行動プログラミングフェイズで設定したappearanceについて「かわいい」などとコメントしていた．また対戦後にお互いのプログラムの内容や今までのプログラミング経験に関するコミュニケーションをとっており，システムを使用することでプログラマ同士のコミュニケーションを促進できていたと考えられる．
また対戦を観察した結果，プレイヤがどうプログラムを変更するか悩んでいる時間が多いため，リアルタイムな観戦においては観戦者が飽きないようにするための工夫が必要だと感じた．なおコードの内容・戦略がやや一辺倒になっていたため，1つの強い戦略に収束してしまわないような工夫が必要である．各々のゲームに着目すると一方のプログラマの書いたプログラムが圧倒的に他方よりも強い場合は1ターンで決着がついてしまう場合があった．
初学者の対戦の観戦においては，ライブでプログラマ同士が対戦している状況を用意することが困難であったため今回は動画を閲覧するという状況を用意したが，動画を見ただけでは実際に人が対戦しているという感覚が希薄であり，「プログラマがプログラミングしている」場面を見せるためには更なる工夫が必要であると感じた．
また今回の評価実験において，システムに対する肯定的な評価が得られたものの，どのような要素が初学者のプログラミングに対する興味に影響を与えていたのか，特に提案システムにおいて独特な要素であるリアルタイムな駆け引き・アドリブを誘発する要素の影響について調査する必要があると考えられる．

\subsection{課題}
\begin{enumerate}
  \item システムの改善

  評価実験でのアンケート結果・コードログの分析結果を鑑みてより良いゲームデザインが必要であると感じた．まずパラメータバランスを調整し，1ターンで終わるなどすぐにゲームが終わって終わないようにする．またプレイヤ同士の対戦において圧倒的に力の差がある場合でも逆転できるような要素を加えることで，プレイヤ・観戦者がより楽しめるようにする．さらにこのゲームにおける強さがプログラマのスキルに比例し，かつ観戦者にとっても可読性の高いプログラムを表示できるよう，最大コード長に制限を設けたり，循環的複雑度の最大値に制限を儲けるなどの工夫を加える．またプロトタイプシステムではエラーを画面にそのまま表示するだけだったが，プレイヤを積極的にデバッグに向かわせる工夫を加える．これらの工夫に伴いUIを設計し直すとともにキャラクタのエフェクトも観戦に適切なものを採用する．

  \item 今後の研究

  今後はシステムに改善を加えつつもより多くのユーザを対象とし，ワークショップとシステム利用による効果の調査を繰り返す．習熟したプログラマだけでなく，プログラミング初学者にも提案システムのゲームをプレイさせ，そのプログラミングへの影響を調査する．特に本システムのリアルタイム性・アドリブによる効果を重点的に調査する．
\end{enumerate}

